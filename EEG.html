<!DOCTYPE html>
<html class="page">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Tim E | EEG</title>
    <meta name="" content="">
    <meta name="robots" content="noindex">
    <link rel="icon" type="image/png" sizes="980x980" href="assets/img/favicon/duck_transparent.png">
    <link rel="icon" type="image/png" sizes="980x980" href="assets/img/favicon/duck_transparent.png" media="(prefers-color-scheme: dark)">
    <link rel="icon" type="image/png" sizes="980x980" href="assets/img/favicon/duck_transparent.png">
    <link rel="icon" type="image/png" sizes="980x980" href="assets/img/favicon/duck_transparent.png" media="(prefers-color-scheme: dark)">
    <link rel="icon" type="image/png" sizes="980x980" href="assets/img/favicon/duck_transparent.png">
    <link rel="icon" type="image/png" sizes="980x980" href="assets/img/favicon/duck_transparent.png">
    <link rel="icon" type="image/png" sizes="980x980" href="assets/img/favicon/duck_transparent.png">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Actor&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Anaheim&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Darker+Grotesque&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora&amp;display=swap">
    <link rel="stylesheet" href="assets/css/Article-Clean.css">
    <link rel="stylesheet" href="assets/css/Article-Dual-Column.css">
    <link rel="stylesheet" href="assets/css/Article-List.css">
    <link rel="stylesheet" href="assets/css/Footer-Basic.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/css/pikaday.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.3.1/css/swiper.min.css">
    <link rel="stylesheet" href="assets/css/Navigation-Clean.css">
    <link rel="stylesheet" href="assets/css/page.css">
    <link rel="stylesheet" href="assets/css/Simple-Slider-swiper.min.css">
    <link rel="stylesheet" href="assets/css/Simple-Slider.css">
    <link rel="stylesheet" href="assets/css/untitled-1.css">
    <link rel="stylesheet" href="assets/css/untitled-2.css">
    <link rel="stylesheet" href="assets/css/untitled-7.css">
    <link rel="stylesheet" href="assets/css/untitled-8.css">
    <link rel="stylesheet" href="assets/css/untitled.css">
</head>

<body>
    <nav class="navbar navbar-light navbar-expand-md d-flex flex-shrink-1 justify-content-sm-center align-items-sm-start navigation-clean" style="background: linear-gradient(120deg, #929293, #052c48);">
        <div class="container"><a class="navbar-brand" href="index.html" style="font-size: 29px;color: rgb(255,255,255);font-family: 'Lato';">Tim Erwin</a><button data-toggle="collapse" class="navbar-toggler" data-target="#navcol-1"><span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon" style="color: rgb(255,255,255);filter: brightness(0%) contrast(200%) grayscale(1%) hue-rotate(0deg) invert(100%);"></span></button>
            <div class="collapse navbar-collapse" id="navcol-1">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"></li>
                    <li class="nav-item"></li>
                    <li class="nav-item dropdown"><a class="dropdown-toggle nav-link" aria-expanded="false" data-toggle="dropdown" href="#" style="color: rgb(255,255,255);font-size: 22px;">Projects</a>
                        <div class="dropdown-menu"><a class="dropdown-item" href="index.html">All Projects</a><a class="dropdown-item" href="EEG.html">EEG Neurofeedback</a><a class="dropdown-item" href="CE.html">CE Amplifier</a><a class="dropdown-item" href="vegebox.html">Vegebox</a><a class="dropdown-item" href="flyback.html">Flyback Converter</a><a class="dropdown-item" href="electrochlorinator.html">Electro Chlorinator</a><a class="dropdown-item" href="solartracker.html">Solar Tracker</a><a class="dropdown-item" href="lm386.html">Audio Amplifier</a></div>
                    </li>
                    <li class="nav-item"></li>
                </ul>
            </div>
        </div>
    </nav>
    <main class="page lanidng-page"></main>
    <div class="d-flex justify-content-center align-items-center align-content-center align-self-center article-clean" style="padding-bottom: 37px;text-shadow: 0px 0px;">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 col-xl-8 offset-lg-1 offset-xl-2 d-flex flex-column flex-grow-1 flex-shrink-1 align-content-center justify-content-lg-center align-items-lg-center" style="padding-left: 27px;">
                    <div class="intro">
                        <h1 class="text-center" style="font-family: Anaheim, sans-serif;font-size: 39px;">2-Channel EEG Neurofeedback</h1>
                        <p class="text-center"> <a href="#" style="font-family: Anaheim, sans-serif;font-size: 16px;">Tim Erwin</a><span class="date" style="font-size: 15px;">March 2024</span></p>
                    </div>
                    <h2 class="align-self-start" style="font-family: Anaheim, sans-serif;font-size: 25px;line-height: 29px;font-weight: 700;">Summary</h2>
                    <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/biofeedback_loop.png" style="width: 100%;max-width: 330px;margin-bottom: 20px;margin-top: 14px;"></div>
                    <div class="flex-column justify-content-center align-content-center text">
                        <p style="font-family: Anaheim, sans-serif;"><span style="color: rgb(0, 0, 0);">This project is an EEG-based neurofeedback system which provides users with real-time feedback on their level of focus or relaxation. By analyzing the spectral content&nbsp;of the brain activity measured via scalp electrodes, focus and relaxation levels can be quantified. Based on these measurements, live feedback in the form of moving bar graphs is provided to users, allowing them to gain awareness of their mental state and more efficiently learn how to consciously&nbsp;relax or focus. This project covers the design of the system, including amplification and filtering stages, digitization, and signal processing. The system interfaces with a PC, displaying the real-time brain activity and a visual representation of relaxation and concentration&nbsp;levels.&nbsp;</span></p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 25px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Background</h2>
                        <p style="font-family: Anaheim, sans-serif;"><span style="color: rgb(0, 0, 0); background-color: transparent;">Electroencephalography (EEG), is a method of recording the electrical activity of the brain, typically with non-invasive scalp electrodes. The electrical signals captured via the electrodes are due to the postsynaptic&nbsp;potentials of neurons in the brain, and can be&nbsp;</span><span style="color: rgb(0, 0, 0);">analyzed based on frequency composition and the specific brain regions associated with the originating activity.&nbsp;</span></p>
                        <p style="font-family: Anaheim, sans-serif;color: rgb(0,0,0);"><span style="color: rgb(0, 0, 0);">The frequencies present in EEG are categorized into the following bands: delta (less than 4 Hz), theta (4-8 Hz), alpha (8-12 Hz), beta (12-30 Hz), and gamma (30-100 Hz). Each of the brainwave frequency ranges provide insights on specific physiological functions, and by measuring the relative power of the frequency ranges, changes in mental states can be quantified.&nbsp;</span>The neurofeedback system presented in this work aims to provide quantified relaxation and concentration values to be used in training attention and stress reduction. The key frequency bands of interest for this system are theta, alpha, and beta. Beta frequencies, associated with increased cognitive activity and concentration, can be broken into three sub-bands to allow for differentiation between relaxed focus and stress. Theta frequencies are linked to deep relaxation and sleep, while alpha frequencies represent alertness and peacefulness. Most neurofeedback techniques for training relaxation involve encouraging low-frequency bands and reducing the activity of higher frequencies during relaxation, without encouraging very low frequencies (theta), to the point of falling asleep. When training concentration, the goal is to increase the activity of higher frequencies.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;">
                            <div class="table-responsive d-lg-flex" style="max-width: 478px;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th style="font-weight: bold;">Brainwave Type</th>
                                            <th>Frequency</th>
                                            <th>Mental State</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Theta</td>
                                            <td>4-8 Hz</td>
                                            <td>Deep relaxation, light sleep</td>
                                        </tr>
                                        <tr>
                                            <td>Alpha</td>
                                            <td>8-12 Hz</td>
                                            <td>Alert relaxation</td>
                                        </tr>
                                        <tr>
                                            <td>Low Beta</td>
                                            <td>12-15 Hz</td>
                                            <td>Relaxed focus</td>
                                        </tr>
                                        <tr>
                                            <td>Mid Beta</td>
                                            <td>15-20 Hz</td>
                                            <td>Thinking</td>
                                        </tr>
                                        <tr>
                                            <td>High Beta</td>
                                            <td>20-30 Hz</td>
                                            <td>Alertness, agitation</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;margin-bottom: 20px;"><span style="color: rgb(0, 0, 0);">Summary of EEG frequency bands</span></p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 25px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">System Architecture</h2>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/SystemOverview.png" style="width: 100%;max-width: 713px;margin-bottom: 5px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;margin-bottom: 20px;"><span style="color: rgb(0, 0, 0);">High-level Block Diagram</span></p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">Due to the small amplitude of voltages detectable by scalp electrodes (10-100μV), amplification and<br>filtering are necessary before digitizing and analyzing brain activity. Based on the smallest expected signal amplitude and assuming an ADC full scale range of around 1V, the system is required to provide a total gain of around 100,000. Filtering is crucial to reduce the strong 60Hz interference from parasitic capacitive coupling to nearby power sources. After digitizing with an ADC, the data is processed to generate live visual feedback of concentration, relaxation levels, and brain activity.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/eeg-systemdesign.png" style="width: 100%;max-width: 713px;margin-bottom: 20px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"><span style="color: rgb(0, 0, 0);">Detailed System Diagram</span></p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">The circuits for power management, amplification, filtering, and digitization are integrated into a custom PCB. Data from the PCB is sent to an STMicroelectronics STM32 NUCLEO-L4A6ZG development board, connected to the user's laptop. The visual feedback and live data stream are displayed on the laptop.<br> </p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/eeg-safety.png" style="width: 100%;max-width: 361px;margin-bottom: 20px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"><span style="color: rgb(0, 0, 0);">Electrical Isolation Diagram</span></p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">To ensure the user’s safety, the system PCB is electrically isolated to prevent the flow of potentially harmful currents between the user and other parts of the system. The figure above shows the location of the isolators in relation to the system. The PCB is galvanically isolated from the power supply by a DC-DC isolation converter, and from the laptop using a digital SPI isolator. This prevents the user from being exposed to any high voltages present at the power supply or laptop’s AC adapter.</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 25px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Electrodes</h2>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/1020.png" style="width: 100%;max-width: 260px;margin-bottom: 1px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"><span style="color: rgb(0, 0, 0);">Electrode Placement Diagram</span></p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;margin-bottom: -51px;"><img class="flex-shrink-1" src="assets/img/EEG/electrodes.png" style="width: 100%;max-width: 234px;margin-bottom: 8px;margin-top: -47px;transform: rotate(270deg);"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"><span style="color: rgb(0, 0, 0);">Electrodes and custom VELCRO headband</span></p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">Silver chloride coated silver (Ag/AgCl) electrodes were chosen due to their availability, low impedance, and low polarization. The low polarization aspect of the electrodes is beneficial due to preventing the buildup of charge on the electrodes, which can generate artifacts and distort the EEG signal.</p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">Electrode positions Fp1, O1, Fp2, and O2 were chosen for the signal electrodes of each channel for a broad picture of the brain and to capture activity in the alpha and beta bands. Beta is commonly found in the front of the brain, and alpha in the back. For user comfort, flat electrodes are used on the forehead, and comb electrodes are used on the back of the head. A flat electrode is placed behind an ear on the mastoid for grounding, a common location due to the absence of strong brain activity signals. Conductive electrode gel is applied to the electrodes before placing them on the user’s head to improve electrical contact with the skin.</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 25px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Hardware Design</h2>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/prototypev2.png" style="width: 100%;max-width: 333px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"><span style="color: rgb(0, 0, 0);">Single-channel Prototype</span></p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/pcb%20image.png" style="width: 100%;max-width: 643px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"><span style="color: rgb(0, 0, 0);">PCB Design</span></p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;height: 512.875px;">
                            <div class="embed-responsive embed-responsive-16by9" style="margin-bottom: 0px;width: 100%;max-width: 718px;height: 100%;max-height: 497px;padding: 0px;"><iframe class="embed-responsive-item" src="https://drive.google.com/file/d/1OA-8PK6xDWuj6iw1PrlOpPfHeAQy9PT2/preview"></iframe></div>
                        </div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"><em><span style="color: rgb(0, 0, 0);">System PCB Schematic</span></em></p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Instrumentation Amplifier</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">EEG signals are typically measured differentially, between pairs of electrodes, to detect the difference in brain activity between two locations on the scalp. The signals are easily masked by common-mode noise, such as noise picked up from power lines, requiring a high common-mode rejection ratio (CMRR). Due to these reasons, an instrumentation amplifier (IA) was chosen as the first amplification stage. Additionally, the high input impedance of a differential instrumentation&nbsp;amplifier minimizes the loading effect on the scalp electrodes.</p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">The device chosen was the AD8237 from Analog Devices, a micropower, zero drift, true rail-to-rail instrumentation amplifier. The AD8237 includes an on-chip RFI filter and ESD protection. External resistors of 1MΩ and 1kΩ set the IA gain to 1000. The output of the amplifier is fed back to the IA’s reference pin through a low frequency inverting integrator implemented with AD8606 op amps. This creates a high-pass filter and cancels the output offset, avoiding the need for large filter capacitors and resistors on the input, which can reduce the CMRR of the amplifier. It is necessary to remove any low-frequency offset to prevent the saturation of the amplifiers. This DC offset and low-frequency drift is due to polarization of electrodes and the movement of electrodes relative to the skin. The 0dB frequency of the inverting integrators was set to 5mHz, which was determined by experimentation to be effective for canceling output offset without greatly impacting the amplification of the low end of the EEG frequency range.</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Sallen-Key Filter</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">A second-order low-pass filter was implemented in the Sallen-Key topology using AD8606 op amps. The cutoff frequency is set to 40Hz to provide significant attenuation of 60Hz noise present in the signals. The Sallen-Key topology was chosen due to simplicity and low component count.</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Variable Amplifier</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">The amplitude of the EEG signals can vary between users and types of electrodes, so a variable amplifier is needed to tune the output of the system to stay within the full-scale range of the ADC. After low-pass filtering, the signals are amplified with non-inverting amplifiers implemented with op amps U4B and U5B. Potentiometers RV1 and RV2 are used to adjust the gain of the amplifiers from 10 to 101.</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Anti-aliasing Filter</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">To minimize the complexity and required number of parts, a simple first-order, low-pass filter is implemented with R18, C16, R19, and C17. The cut-off frequency is set to 160Hz to avoid attenuating the high end of the EEG frequency range (around 30Hz). With this filter, some noise is detectable in the output signal up to 300Hz, so the ADC target sampling frequency is set to 600Hz to prevent aliasing. This sampling rate is only a fraction of the ADC’s maximum, making it a simpler solution than implementing a more complex higher-order analog filter to allow for a lower sampling rate.</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Overall Frequency Response</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">After testing the individual stages described above, the total frequency response was measured to verify the required specifications. The instrumentation amplifier’s response was measured separately and then combined with the results of the subsequent stages to determine the total response. The figure below shows the magnitude response of the instrumentation amplifier, variable amplifier and filters, and the total response of channel two on the PCB. Both channels’ responses are identical. This measurement, taken with the variable amplifier set to the highest gain indicates that the total gain at the EEG frequency range is around 100,000 (100 dB) and quickly drops off to attenuate noise outside the EEG frequency range. The graph also shows reduced gain at low frequencies due to the operation of the feedback integrator of the IA.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/ch2_MAGNITUDEresponse.png" style="width: 100%;max-width: 755px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"><span style="color: rgb(0, 0, 0);">Analog Front End Magnitude Response</span></p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Driven Ground</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">Despite the first amplification stage’s high CMRR, 60Hz interference can arise from mismatched electrode impedances and finite amplifier input impedances, creating a voltage divider effect that causes the common-mode noise to be amplified as a differential signal. An effective way to mitigate this is to reduce the common-mode voltage present on the body as much as possible by applying an amplified and inverted common-mode voltage to the body. The common-mode voltage from each channel is captured by averaging the signals at each of the electrodes with matched resistor arrays RN1 and RN2. After averaging, the signals for each channel are high-pass filtered to remove any offset before buffering with op amps U9B and U11A, and amplifying by U9A in a summing amplifier configuration. C22 reduces the amplifier’s gain at high frequencies to increase stability if the system is ever used with active electrode cable shielding. The output of this circuit is connected to the ground electrode which is placed on the user.</p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">After verifying that the circuit properly inverts and amplifies the average of its input signal, the circuit was tested by comparing EEG signals acquired with and without the use of a driven ground. For the test sessions without the driven ground, the ground electrode was connected to the system’s virtual ground rail. The figure below shows the relative power of the 60Hz interference for two two-minute test sessions. The relative power was calculated by dividing the power at 60Hz by the total power between 0Hz and the Nyquist frequency. A moving average with a span of forty was applied to clarify the data. The graph verifies that applying the amplified and inverted common-mode signal to the body reduces the interference by nearly half.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/DRL_results-nyquist.png" style="width: 100%;max-width: 463px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;">Comparison of the amount of 60Hz interference with and without driven ground.</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">System Enclosure</h2>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/project_enclosure.png" style="width: 100%;max-width: 643px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;"></p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 25px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Software</h2>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Overview</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">The flowchart below depicts a high-level overview of the software implemented on the STM32 and laptop. The STM32 microcontroller configures and calibrates the ADC. When the interrupt signal from the ADC is detected, the latest voltage conversion is read and added to the data queue. While the data queue is not empty, ADC values are sent over UART to be read by the python script running on the laptop. The UART communication is set for a baud rate of 209700 bits per second to ensure timely transmission of data from both ADC channels.&nbsp;The Python code on the laptop is responsible for reading the incoming data, applying real-time filters, quantifying concentration and relaxing, and generating the live displays. To&nbsp;provide real-time feedback and ensure that latency is minimal, the Python code utilizes multiprocessing for the parallel execution of the data transfer, filtering, short-time fourier transform (STFT), calculations, and visualizations for each channel.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/software_flowchart.png" style="width: 100%;max-width: 463px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;">High-level software flowchart</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Filtering</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">After the Python code receives the ADC values via UART, they are converted to voltage, then filtered to reduce noise. The graph below displays the frequency response of the filter, a Hann windowed FIR filter with a passband of 40Hz, stopband of 55Hz, and a group delay of 0.05 seconds. This filter architecture was selected for minimal passband ripple and linear phase response to minimize EEG signal distortion.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/digitalfilter_freqresponse2.png" style="width: 100%;max-width: 526px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;">Frequency response of the digital low-pass filter</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">EEG Band Calculation</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">After filtering, a short-time Fourier transform (STFT) with a window length of one second and 50% overlap calculates the frequency composition of the signals. This window length was chosen for a balance between frequency resolution and delay. The results from the STFT are used to determine the relative powers of each EEG band. The system displays these relative powers, along with relaxation and concentration values. Relaxation is calculated by dividing the sum of the alpha and low beta power by the sum of high and mid beta power; concentration is the inverse. Each of these 30 values are scaled by a constant to be less than or equal to one, based on a calibration session with the user.</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 17px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Real-time Feedback</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">Once the electrodes are set up and the program is started, the real-time visual display begins. Due to the STFT window and overlap length, the bars depicting the power of the EEG frequency bands, concentration level, relaxation level update every 0.5 seconds. Data for both channels is saved in a file for offline analysis of the session’s results.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/test_screenshot.png" style="width: 100%;max-width: 526px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;">Screenshot from the real-time visual display</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 25px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">EEG Experiments</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">To verify that the system is acquiring and amplifying brain activity rather than random noise, several signal characteristics were observed. When someone is relaxed with eyes closed, alpha components dominate, and their amplitude decreases significantly upon eye opening. The figure below displays a spectrogram of a three-minute test session: the first minute with eyes open, the second with eyes closed, and the final minute with eyes open. During the closed-eye period, the alpha amplitude increases, indicated by a color change in the spectrogram, confirming the system detects expected brain activity changes.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/1open-1closed-1open-v1_labels.png" style="width: 100%;max-width: 681px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;">Spectrogram showcasing an increase in alpha when eyes are closed.</p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">Additionally, the presence of blink artifacts indicates proper signal measurement. Electrodes near the eyes detect a large voltage swing during a blink, due to the eye being a dipole. An example of a blink artifact is highlighted in the figure below. These artifacts also appear as low-frequency spikes in the spectrogram during eyes-open periods.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/eyeblink.png" style="width: 100%;max-width: 681px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;">Example of a blink artifact (highlighted)</p>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">Test sessions where the user tried to focus or relax were conducted to verify that concentration and relaxation values could be approximated using EEG frequency band power calculations. From these experiments, it was concluded that it is possible to observe differences between concentration and relaxation using alpha, low beta, mid beta, and high beta. The graph below shows the results of a twenty-five minute test session: five minutes reading and trying to concentrate, ten minutes of relaxing with eyes closed, and ten minutes of reading again. A moving average with a span of forty was applied to clarify the data. The figure shows that the concentration value is highest with the greatest variation during the reading period, and the relaxation value is highest with the greatest variation during the relaxation period.</p>
                        <div class="d-flex flex-shrink-1 justify-content-center justify-content-sm-center" style="display: flex;position: relative;"><img class="flex-shrink-1" src="assets/img/EEG/tessession.png" style="width: 100%;max-width: 681px;margin-bottom: 8px;margin-top: 14px;"></div>
                        <p style="font-family: Anaheim, sans-serif;text-align: center;font-style: italic;">25-minute test session involving reading and relaxing</p>
                        <h2 style="font-family: Anaheim, sans-serif;font-size: 25px;line-height: 29px;font-weight: 700;margin-top: 0px;margin-bottom: 13px;">Conclusion</h2>
                        <p style="font-family: Anaheim, sans-serif;text-align: left;color: rgb(0,0,0);">This project successfully met the requirements of recording a user’s brain electrical activity and providing live feedback on concentration and relaxation levels through spectral analysis. The data gathered by this 2-channel EEG system is only enough to provide an approximation of the user’s mental state, and further modifications to the system to improve accuracy could include adding more channels for more detailed data capture, utilizing spatial analysis in addition to spectral analysis, and machine learning methods. An improvement that could enhance user comfort and reduce setup time could include incorporating active electrodes that buffer the signals captured on the scalp to allow for the use of dry electrodes.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col justify-content-center align-items-center align-content-center align-self-center bottom" style="background: linear-gradient(120deg, #929293, #052c48);height: 67px;position: relative;bottom: 0;margin-top: -6px;margin-left: 0px;min-width: 50px;">
        <ul class="list-inline d-flex justify-content-center align-items-center align-self-center" style="padding: 0px;text-align: center;padding-top: 18px;font-size: 20px;">
            <li class="list-inline-item"><a class="text-light" style="/*font-family: Anaheim, sans-serif;*/color: rgb(255,255,255);" href="secret.html">© Timothy Erwin 2024</a></li>
            <li class="list-inline-item"><a class="text-light" href="index.html" style="/*font-family: Anaheim, sans-serif;*/margin-left: 19px;">Home</a></li>
            <li class="list-inline-item"></li>
        </ul>
    </div><script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101294001);</script>
<script async src="//static.getclicky.com/js"></script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101294001ns.gif" /></p></noscript>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/pikaday.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.3.1/js/swiper.jquery.min.js"></script>
    <script src="assets/js/Simple-Slider-swiper.jquery.min.js"></script>
    <script src="assets/js/Simple-Slider.js"></script>
    <script src="assets/js/theme.js"></script>
</body>

</html>